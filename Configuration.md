Конфигурация фреймворка, переменные среды
=========================================

[Статья официальной документации](https://symfony.com/doc/current/configuration.html)

Первоначальная конфигурация проекта создаётся при выполнении `composer ctreate-project` (или вручную), состоит из yaml / php / xml файлов и находится в каталоге `config` проекта.

```
symfony-learning/
├─ config/
│  ├─ packages/
│  ├─ bundles.php
│  ├─ routes.yaml
│  └─ services.yaml
├─ ...
```

Переменные окружения
--------------------

Переменные окружения это понятие ОС, то есть они существуют независимо от фреймворка, разработки или чего-то ещё. Большинство языков программирования позволяют получить переменные окружения из ОС, и каким-то образом взаимодействовать с ними.

Современне веб-фреймвоки очень часто опираются в своих настройках на переменные окружения, но существует определеная проблема в том, чтобы их комплексно задавать (экспортировать) и удалять. Естественно, мало кому понравится десятки раз писать в консоли `export ENV_VAR=value` прежде чем начать работу с проектом.

Для этого были придуманы `.env`-файлы.

Такие файлы содержат в себе список переменных среды и могут содержать их значения. В парадигме symfony-framework основной `.env`-файл существует в рамках репозитория (под контролем версий), но актуальные переменные среды загружаются не из него. 

Для актуальных значений есть, во-первых, файлы `.env.local`/`.env.<environment>.local` и во-вторых (для production-конфигурации) — файл `.env.local.php`, который генерируется командой `composer dump-env <environment>`. Если этот файл существует, то все значения переменных (включая, собственно, определение окружения, то есть `dev`, `prod` или `test`) будут взяты именно из него.

Генерировать этот файл необязательно, как необязательно и иметь локальные `.env`-файлы — достаточно экспортировать нужные переменные окружения, и они будут загружены непосредственно из ОС. Естественно, во время разработки никто так не будет делать, но при деплое вашего приложения в продакшн-среду это очень актуальный подход.

Помните о том, что `.env`-файл это не непосредственно файл конфигурации приложения, это **всего лишь эмуляция** существующих переменных окружения, не более того. 

Конфигурация пакетов (бандлов)
------------------------------

В каталоге `config/packages` (в большинстве случаев) содержатся файлы конфигурации для всех бандлов, установленных для приложения. Работает это довольно интересным образом.

Предположим, вы пишете, или используете бандл (компонент), который реализует в себе какую-то логику. Внутри этого бандла объявляются сервисы, параметры и прочие настройки, необходимые для его работы. Эти настройки нельзя редактировать (это пакет поставщика), но можно переопределить — чем, собственно, и занимается движок, когда видит конфигурацию бандла в `config/packages`.

Конфигурации для определенных окружений
---------------------------------------

Когда мы в процессе разработки, нам нужен дебаггер, трассировщик и профайлер. Когда приложение работает в продакшн, они не нужны, и более того, вредны. Когда мы запускаем тесты, нам не следует обращаться к внешним сервисам — в какой-то момент эти сервисы могут быть недоступны, что повилияет на тесты и их устойчивость. 

Чтобы использовать разные конфигурации в зависимости от окружения, в symfony-framework разделяются файлы конфигураций, параметры загрузки бандлов, параметры загрузки контейнера и роутов.

Различные настройки пакетов хранятся в `config/packages/<environment>`, загрузка бандлов (`config/bundles.php`) разделена по окружениям с помощью параметров, и для конфигурации сервисов используются вариации файла `config/services_<environment>.yaml`

Сервисы в `config/services_test.yaml` переопределяются в дополнение к основной конфигурации, то есть там необязательно объявлять все сервисы, которые есть в основном файле, достаточно только нужных. 
